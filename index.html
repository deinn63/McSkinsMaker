<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>McSkinsCreat</title>
  <meta name="description" content="McSkinsCreat ‚Äì Minecraft Skin Editor mit 3D Vorschau, Tools, Farbe, Import/Download." />

  <!-- 3D Skin Viewer -->
  <script src="https://unpkg.com/skinview3d@3.0.0/bundle/skinview3d.bundle.js"></script>

  <style>
    :root{
      --accent:#ff7a00;
      --dark:#2f2f2f;
      --dark2:#3f3f3f;
      --light:#f2f2f2;
      --border:#5c5c5c;
      --shadow: 0 10px 25px rgba(0,0,0,.18);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:#d9d9d9;
      color:#111;
    }

    /* ===== Header like SkinDex ===== */
    .topbar{
      position:relative;
      height:92px;
      background: url("mc_bg.png") center/cover no-repeat;
      overflow:hidden;
      border-bottom: 3px solid rgba(0,0,0,.12);
    }
    .topbar::after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(to bottom, rgba(255,255,255,.12), rgba(255,255,255,.55));
      pointer-events:none;
    }
    .brand{
      position:absolute;
      left:50%;
      top:16px;
      transform:translateX(-50%);
      z-index:3;
      font-weight:900;
      font-size:40px;
      color:var(--accent);
      text-shadow: 0 3px 0 rgba(0,0,0,.15);
      white-space:nowrap;
    }
    .zombie{
      position:absolute;
      left:50%;
      top:-6px;
      transform:translateX(-50%);
      height:110px;
      z-index:4;
      filter: drop-shadow(0 10px 10px rgba(0,0,0,.25));
      pointer-events:none;
    }
    .navrow{
      position:absolute;
      left:0; right:0;
      bottom:0;
      z-index:5;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:18px;
      padding:10px 12px;
      background: rgba(255,255,255,.60);
      backdrop-filter: blur(6px);
      border-top: 1px solid rgba(0,0,0,.08);
    }
    .navrow a{
      text-decoration:none;
      color:#111;
      font-weight:900;
      font-size:14px;
      padding:6px 8px;
      border-radius:8px;
    }
    .navrow a:hover{ background: rgba(255,122,0,.18); }
    .navrow .active{ background: rgba(255,122,0,.18); }

    .search{
      display:flex; align-items:center; gap:8px;
      margin-left:10px;
    }
    .search select, .search input{
      height:32px;
      border-radius:10px;
      border:1px solid rgba(0,0,0,.18);
      padding:0 10px;
      background:rgba(255,255,255,.9);
      outline:none;
      font-weight:800;
    }
    .search input{ width:260px; max-width:40vw; }

    /* ===== Layout: left tools / center 3D / right panel ===== */
    .wrap{
      max-width: 1220px;
      margin: 16px auto 28px;
      padding: 0 16px;
      display:grid;
      grid-template-columns: 88px 1fr 320px;
      gap:16px;
    }

    .tools{
      background: var(--dark2);
      border: 2px solid var(--border);
      border-radius: 10px;
      box-shadow: var(--shadow);
      padding:8px;
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height: 640px;
    }
    .toolbtn{
      height:64px;
      border-radius:8px;
      border: 2px solid rgba(255,255,255,.14);
      background: #4b4b4b;
      color:#fff;
      font-weight:1000;
      cursor:pointer;
      display:grid;
      place-items:center;
      user-select:none;
    }
    .toolbtn.active{
      outline: 3px solid var(--accent);
      background:#5a5a5a;
    }
    .toolgrid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:8px;
    }
    .toolbtn.mini{ height:56px; font-weight:900; }
    .reset{
      margin-top:auto;
      height:36px;
      border-radius:10px;
      background:#5b5b5b;
      border:1px solid rgba(255,255,255,.18);
      color:#fff;
      font-weight:1000;
      cursor:pointer;
    }

    .center{
      background:#efefef;
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding:14px;
      border: 1px solid rgba(0,0,0,.12);
      min-height: 640px;
      position:relative;
    }
    .viewerBox{
      width:100%;
      height: 600px;
      border-radius:12px;
      background:#f7f7f7;
      border:1px solid rgba(0,0,0,.12);
      overflow:hidden;
      position:relative;
    }
    .hint{
      position:absolute;
      left:14px;
      bottom:14px;
      background: rgba(0,0,0,.68);
      color:#fff;
      padding:10px 12px;
      border-radius:12px;
      font-size:12px;
      font-weight:800;
      max-width: 460px;
    }
    .hint code{ background: rgba(255,255,255,.14); padding:2px 6px; border-radius:8px; }

    .right{
      background: #efefef;
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding:14px;
      border: 1px solid rgba(0,0,0,.12);
      min-height: 640px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .card{
      background:#fff;
      border:1px solid rgba(0,0,0,.12);
      border-radius:12px;
      padding:12px;
    }
    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .label{ font-weight:1000; }
    input[type="color"]{ width:56px; height:40px; border:none; background:transparent; cursor:pointer; }
    input[type="range"]{ width: 160px; }
    .hex{
      font-weight:1000;
      background:#111;
      color:#fff;
      padding:10px 12px;
      border-radius:999px;
      min-width:110px;
      text-align:center;
    }
    .pill{
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(0,0,0,.12);
      background:#f6f6f6;
      font-weight:1000;
      cursor:pointer;
    }
    .pill.active{
      background: rgba(255,122,0,.14);
      border-color: rgba(255,122,0,.35);
    }
    .parts{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:8px;
      margin-top:10px;
    }
    .part{
      height:48px;
      border-radius:10px;
      border:2px solid rgba(255,122,0,.55);
      background:#fff;
      cursor:pointer;
      display:grid;
      place-items:center;
      font-weight:1000;
    }
    .part.active{
      background: rgba(255,122,0,.12);
      outline: 2px solid rgba(255,122,0,.75);
    }
    .bottomBtns{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:10px;
      margin-top:auto;
    }
    .bigbtn{
      height:58px;
      border-radius:12px;
      border: 2px solid rgba(0,0,0,.15);
      background: #4b4b4b;
      color:#fff;
      font-weight:1000;
      cursor:pointer;
    }
    .bigbtn:hover{ filter:brightness(1.08); }
    .bigbtn.primary{
      background: var(--accent);
      border-color: rgba(0,0,0,.12);
      color:#1a1a1a;
    }

    @media (max-width: 980px){
      .wrap{ grid-template-columns: 88px 1fr; grid-template-rows:auto auto; }
      .right{ grid-column: 1 / -1; }
      .viewerBox{ height: 420px; }
      .tools{ min-height: unset; }
    }
  </style>
</head>

<body>
  <div class="topbar">
    <img class="zombie" src="zombie.png" alt="Zombie" />
    <div class="brand">McSkinsCreat</div>

    <div class="navrow">
      <a href="#top">Top</a>
      <a href="#latest">Latest</a>
      <a href="#recent">Recently Commented</a>
      <a class="active" href="#editor">Editor</a>
      <a href="#upload">Upload</a>
      <a href="#grabber">Skin Grabber</a>

      <div class="search">
        <select>
          <option>Skins</option>
          <option>Users</option>
          <option>Tags</option>
        </select>
        <input id="searchInput" placeholder="Suche..." />
      </div>
    </div>
  </div>

  <div class="wrap" id="editor">
    <!-- LEFT -->
    <aside class="tools">
      <div class="toolbtn active" data-tool="brush">‚úèÔ∏è</div>
      <div class="toolbtn" data-tool="eraser">üßΩ</div>
      <div class="toolbtn" data-tool="picker">üß™</div>
      <div class="toolbtn" data-tool="fill">ü™£</div>

      <div class="toolgrid2">
        <div class="toolbtn mini" id="undoBtn">‚Ü∂</div>
        <div class="toolbtn mini" id="redoBtn">‚Ü∑</div>
        <div class="toolbtn mini" id="zoomInBtn">üîç‚ûï</div>
        <div class="toolbtn mini" id="zoomOutBtn">üîç‚ûñ</div>
      </div>

      <button class="reset" id="resetBtn">Reset Skin</button>
    </aside>

    <!-- CENTER -->
    <main class="center">
      <div class="viewerBox" id="viewerBox"></div>
      <div class="hint">
        <div><b>Drehen:</b> Maus ziehen.</div>
        <div><b>Malen:</b> <code>Shift</code> halten + klicken/ziehen (damit Drehen nicht st√∂rt).</div>
        <div><b>Download:</b> unten ‚ÄûDownload‚Äú ‚Üí PNG ‚Üí Minecraft importieren.</div>
      </div>
    </main>

    <!-- RIGHT -->
    <aside class="right">
      <div class="card">
        <div class="label">Farbe</div>
        <div class="row" style="margin-top:10px;">
          <input id="colorInput" type="color" value="#123456" />
          <div id="hexOut" class="hex">#123456</div>
        </div>
        <div class="row" style="margin-top:12px;">
          <div class="label">Pinselgr√∂√üe</div>
          <input id="brushSize" type="range" min="1" max="8" value="1" />
        </div>
      </div>

      <div class="card">
        <div class="row">
          <button class="pill active" id="layerBodyBtn">Body</button>
          <button class="pill" id="layerOuterBtn">Outer layer</button>
        </div>

        <div class="parts">
          <div class="part active" data-part="all">All</div>
          <div class="part" data-part="head">Head</div>
          <div class="part" data-part="body">Body</div>
          <div class="part" data-part="armL">Arm L</div>
          <div class="part" data-part="armR">Arm R</div>
          <div class="part" data-part="legs">Legs</div>
        </div>

        <div style="margin-top:10px; font-size:12px; opacity:.85; font-weight:800;">
          Tipp: Teile = Fokus-Zoom (nur Ansicht).
        </div>
      </div>

      <div class="bottomBtns">
        <button class="bigbtn" id="uploadBtn">Upload</button>
        <button class="bigbtn primary" id="downloadBtn">Download</button>
        <button class="bigbtn" id="importBtn">Import</button>
      </div>

      <input id="fileInput" type="file" accept="image/png" style="display:none;" />
    </aside>
  </div>

  <script>
    // ===== Skin canvas (64x64) =====
    const SKIN_W = 64, SKIN_H = 64;
    const skinCanvas = document.createElement("canvas");
    skinCanvas.width = SKIN_W;
    skinCanvas.height = SKIN_H;
    const skinCtx = skinCanvas.getContext("2d", { willReadFrequently: true });

    // Undo/Redo
    const undoStack = [];
    const redoStack = [];
    function pushUndo() {
      undoStack.push(skinCtx.getImageData(0,0,SKIN_W,SKIN_H));
      if (undoStack.length > 40) undoStack.shift();
      redoStack.length = 0;
    }
    function undo() {
      if (!undoStack.length) return;
      redoStack.push(skinCtx.getImageData(0,0,SKIN_W,SKIN_H));
      skinCtx.putImageData(undoStack.pop(),0,0);
      refreshViewerSkin();
    }
    function redo() {
      if (!redoStack.length) return;
      undoStack.push(skinCtx.getImageData(0,0,SKIN_W,SKIN_H));
      skinCtx.putImageData(redoStack.pop(),0,0);
      refreshViewerSkin();
    }

    // ===== Viewer =====
    const viewerBox = document.getElementById("viewerBox");
    const canvas3d = document.createElement("canvas");
    canvas3d.style.width = "100%";
    canvas3d.style.height = "100%";
    viewerBox.appendChild(canvas3d);

    const skinViewer = new skinview3d.SkinViewer({
      canvas: canvas3d,
      width: viewerBox.clientWidth,
      height: viewerBox.clientHeight,
      skin: "https://raw.githubusercontent.com/bs-community/skinview3d/master/examples/steve.png",
      background: null
    });

    skinViewer.controls.enableZoom = true;
    skinViewer.controls.enablePan = false;
    skinViewer.controls.rotateSpeed = 0.9;
    skinViewer.light.setPosition(0, 100, 100);
    skinViewer.camera.position.set(0, 18, 45);

    const ro = new ResizeObserver(() => {
      skinViewer.setSize(viewerBox.clientWidth, viewerBox.clientHeight);
    });
    ro.observe(viewerBox);

    async function loadInitialSkin(url) {
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.onload = () => {
        skinCtx.imageSmoothingEnabled = false;
        skinCtx.clearRect(0,0,SKIN_W,SKIN_H);
        skinCtx.drawImage(img,0,0,SKIN_W,SKIN_H);
        pushUndo();
        refreshViewerSkin();
      };
      img.src = url;
    }
    loadInitialSkin("https://raw.githubusercontent.com/bs-community/skinview3d/master/examples/steve.png");

    function refreshViewerSkin() {
      skinViewer.loadSkin(skinCanvas.toDataURL("image/png"), {model:"default"});
    }

    // ===== Tools =====
    let currentTool = "brush";
    let currentColor = "#123456";
    let brushSize = 1;

    const hexOut = document.getElementById("hexOut");
    const colorInput = document.getElementById("colorInput");
    const brushSizeInput = document.getElementById("brushSize");

    colorInput.addEventListener("input", (e) => {
      currentColor = e.target.value.toLowerCase();
      hexOut.textContent = currentColor.toUpperCase();
    });
    brushSizeInput.addEventListener("input", (e) => brushSize = Number(e.target.value));

    document.querySelectorAll(".toolbtn[data-tool]").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".toolbtn[data-tool]").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentTool = btn.dataset.tool;
      });
    });

    // Layer buttons (UI only)
    const layerBodyBtn = document.getElementById("layerBodyBtn");
    const layerOuterBtn = document.getElementById("layerOuterBtn");
    layerBodyBtn.addEventListener("click", () => { layerBodyBtn.classList.add("active"); layerOuterBtn.classList.remove("active"); });
    layerOuterBtn.addEventListener("click", () => { layerOuterBtn.classList.add("active"); layerBodyBtn.classList.remove("active"); });

    // Parts focus camera
    function focusCamera(part){
      const cam = skinViewer.camera;
      if(part==="head") cam.position.set(0, 26, 34);
      else if(part==="body") cam.position.set(0, 18, 42);
      else if(part==="armL") cam.position.set(-14, 18, 42);
      else if(part==="armR") cam.position.set(14, 18, 42);
      else if(part==="legs") cam.position.set(0, 8, 42);
      else cam.position.set(0, 18, 45);
    }
    document.querySelectorAll(".part").forEach(p=>{
      p.addEventListener("click", ()=>{
        document.querySelectorAll(".part").forEach(x=>x.classList.remove("active"));
        p.classList.add("active");
        focusCamera(p.dataset.part);
      });
    });

    // Undo/redo/zoom/reset
    document.getElementById("undoBtn").addEventListener("click", undo);
    document.getElementById("redoBtn").addEventListener("click", redo);
    document.getElementById("zoomInBtn").addEventListener("click", () => skinViewer.camera.position.multiplyScalar(0.92));
    document.getElementById("zoomOutBtn").addEventListener("click", () => skinViewer.camera.position.multiplyScalar(1.08));
    document.getElementById("resetBtn").addEventListener("click", () => loadInitialSkin("https://raw.githubusercontent.com/bs-community/skinview3d/master/examples/steve.png"));

    // ===== Paint on model (Shift = paint, sonst drehen) =====
    function hexToRgba(hex){
      const h = hex.replace("#","");
      return [parseInt(h.slice(0,2),16), parseInt(h.slice(2,4),16), parseInt(h.slice(4,6),16), 255];
    }
    function getPointerNDC(ev){
      const rect = canvas3d.getBoundingClientRect();
      const x = ((ev.clientX - rect.left) / rect.width) * 2 - 1;
      const y = -(((ev.clientY - rect.top) / rect.height) * 2 - 1);
      return {x,y};
    }
    function getAllMeshes(obj){
      const meshes = [];
      obj.traverse?.((n) => { if(n.isMesh) meshes.push(n); });
      return meshes;
    }

    function paintAtUV(uv){
      const px = Math.floor(uv.x * SKIN_W);
      const py = Math.floor((1 - uv.y) * SKIN_H);

      pushUndo();

      if(currentTool==="picker"){
        const d = skinCtx.getImageData(px,py,1,1).data;
        const hx = "#" + [d[0],d[1],d[2]].map(v => v.toString(16).padStart(2,"0")).join("");
        currentColor = hx;
        colorInput.value = hx;
        hexOut.textContent = hx.toUpperCase();
        return;
      }

      if(currentTool==="fill"){
        // simple fill (fast)
        const target = skinCtx.getImageData(px,py,1,1).data;
        const fill = new Uint8ClampedArray(hexToRgba(currentColor));
        if(target[0]===fill[0]&&target[1]===fill[1]&&target[2]===fill[2]&&target[3]===fill[3]) return;

        const img = skinCtx.getImageData(0,0,SKIN_W,SKIN_H);
        const data = img.data;
        const idx = (x,y)=> (y*SKIN_W+x)*4;
        const t = data.slice(idx(px,py), idx(px,py)+4);

        const q=[[px,py]];
        const seen=new Set();
        while(q.length){
          const [cx,cy]=q.pop();
          const key=cx+","+cy;
          if(seen.has(key)) continue;
          seen.add(key);
          if(cx<0||cy<0||cx>=SKIN_W||cy>=SKIN_H) continue;
          const i=idx(cx,cy);
          if(data[i]!==t[0]||data[i+1]!==t[1]||data[i+2]!==t[2]||data[i+3]!==t[3]) continue;
          data[i]=fill[0]; data[i+1]=fill[1]; data[i+2]=fill[2]; data[i+3]=fill[3];
          q.push([cx+1,cy],[cx-1,cy],[cx,cy+1],[cx,cy-1]);
        }
        skinCtx.putImageData(img,0,0);
        refreshViewerSkin();
        return;
      }

      const [r,g,b,a] = (currentTool==="eraser") ? [0,0,0,0] : hexToRgba(currentColor);
      for(let dy=0; dy<brushSize; dy++){
        for(let dx=0; dx<brushSize; dx++){
          const x=px+dx, y=py+dy;
          if(x<0||y<0||x>=SKIN_W||y>=SKIN_H) continue;
          const p = skinCtx.getImageData(x,y,1,1);
          p.data[0]=r; p.data[1]=g; p.data[2]=b; p.data[3]=a;
          skinCtx.putImageData(p,x,y);
        }
      }
      refreshViewerSkin();
    }

    let isDown=false, painting=false;

    function tryPaint(ev){
      if(!ev.shiftKey) return;
      const ndc = getPointerNDC(ev);
      const raycaster = new skinview3d.THREE.Raycaster();
      raycaster.setFromCamera(ndc, skinViewer.camera);
      const hits = raycaster.intersectObjects(getAllMeshes(skinViewer.playerObject), true);
      if(!hits.length) return;
      const hit = hits[0];
      if(!hit.uv) return;
      paintAtUV(hit.uv);
    }

    canvas3d.addEventListener("pointerdown", (ev) => {
      isDown=true;
      painting = ev.shiftKey;
      if(painting) tryPaint(ev);
    });
    canvas3d.addEventListener("pointermove", (ev) => {
      if(!isDown) return;
      if(painting) tryPaint(ev);
    });
    window.addEventListener("pointerup", ()=>{ isDown=false; painting=false; });

    // Download / Import
    document.getElementById("downloadBtn").addEventListener("click", () => {
      const a=document.createElement("a");
      a.download="McSkinsCreat_skin.png";
      a.href=skinCanvas.toDataURL("image/png");
      a.click();
    });

    const fileInput=document.getElementById("fileInput");
    document.getElementById("importBtn").addEventListener("click", ()=> fileInput.click());
    fileInput.addEventListener("change",(e)=>{
      const f=e.target.files?.[0]; if(!f) return;
      const img=new Image();
      img.onload=()=>{
        if(img.width!==64||img.height!==64){ alert("Bitte 64x64 Skin PNG ausw√§hlen."); return; }
        pushUndo();
        skinCtx.clearRect(0,0,SKIN_W,SKIN_H);
        skinCtx.drawImage(img,0,0);
        refreshViewerSkin();
      };
      img.src=URL.createObjectURL(f);
      fileInput.value="";
    });

    // Upload placeholder (GitHub Pages kann kein Backend)
    document.getElementById("uploadBtn").addEventListener("click", () => {
      alert("Upload braucht Backend. Wenn du willst, machen wir als n√§chsten Schritt Vercel-Backend (ohne Firebase), dann k√∂nnen User ver√∂ffentlichen.");
    });
  </script>
</body>
</html>
